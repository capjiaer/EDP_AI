# è¿ç§»æŒ‡å—

æœ¬æ–‡æ¡£å¸®åŠ©ç”¨æˆ·ä»æ—§ç‰ˆæœ¬è¿ç§»åˆ°æ–°ç‰ˆæœ¬ï¼Œæˆ–ä»å…¶ä»–å·¥å…·è¿ç§»åˆ° EDP_AI æ¡†æ¶ã€‚

## ğŸ“‹ ç›®å½•

- [ç‰ˆæœ¬è¿ç§»](#ç‰ˆæœ¬è¿ç§»)
- [ä»å…¶ä»–å·¥å…·è¿ç§»](#ä»å…¶ä»–å·¥å…·è¿ç§»)
- [ç ´åæ€§å˜æ›´](#ç ´åæ€§å˜æ›´)
- [è¿ç§»æ£€æŸ¥æ¸…å•](#è¿ç§»æ£€æŸ¥æ¸…å•)

---

## ç‰ˆæœ¬è¿ç§»

### ä» v1.x è¿ç§»åˆ° v2.x

#### 1. ç›®å½•ç»“æ„å˜æ›´

**æ—§ç»“æ„ï¼š**
```
scripts/          # æ—§ç›®å½•å
util/             # æ—§ç›®å½•å
```

**æ–°ç»“æ„ï¼š**
```
steps/            # æ–°ç›®å½•å
helpers/          # æ–°ç›®å½•å
```

**è¿ç§»æ­¥éª¤ï¼š**
```bash
# é‡å‘½åç›®å½•
mv scripts/ steps/
mv util/ helpers/

# æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„å¼•ç”¨
```

#### 2. CLI å‚æ•°å˜æ›´

**æ—§å‚æ•°ï¼š**
```bash
edp --dir-list /path/to/dir
edp -I /path/to/include
```

**æ–°å‚æ•°ï¼š**
```bash
edp --search-paths /path/to/dir
edp -d /path/to/include
```

**è¿ç§»æ­¥éª¤ï¼š**
1. æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨æ—§å‚æ•°çš„è„šæœ¬
2. æ›¿æ¢ä¸ºæ–°çš„å‚æ•°å
3. æµ‹è¯•è„šæœ¬æ˜¯å¦æ­£å¸¸å·¥ä½œ

#### 3. #import util ç§»é™¤

**æ—§æ–¹å¼ï¼š**
```tcl
#import util helper.tcl
```

**æ–°æ–¹å¼ï¼š**
```tcl
#import source helper.tcl
```

**è¿ç§»æ­¥éª¤ï¼š**
1. æŸ¥æ‰¾æ‰€æœ‰ `#import util` æŒ‡ä»¤
2. æ›¿æ¢ä¸º `#import source`
3. æ›´æ–°ç›¸å…³ Hooks æ–‡ä»¶

---

## ä»å…¶ä»–å·¥å…·è¿ç§»

### ä»è‡ªå®šä¹‰è„šæœ¬è¿ç§»

#### 1. åˆ†æç°æœ‰è„šæœ¬ç»“æ„

**è¯†åˆ«ç»„ä»¶ï¼š**
- ä¸»è„šæœ¬æ–‡ä»¶
- è¾…åŠ©è„šæœ¬æ–‡ä»¶
- é…ç½®æ–‡ä»¶
- ä¾èµ–å…³ç³»

#### 2. åˆ›å»ºé¡¹ç›®ç»“æ„

```bash
# åˆå§‹åŒ–é¡¹ç›®
edp_init -init -prj project_name -v version --block block1 --user user1
```

#### 3. è¿ç§»è„šæœ¬æ–‡ä»¶

**æ­¥éª¤ï¼š**
1. å°†ä¸»è„šæœ¬å¤åˆ¶åˆ° `cmds/{flow}/{step}.tcl`
2. å°†è¾…åŠ©è„šæœ¬å¤åˆ¶åˆ° `cmds/{flow}/helpers/`
3. æ›´æ–°è„šæœ¬ä¸­çš„è·¯å¾„å¼•ç”¨

#### 4. è¿ç§»é…ç½®

**æ­¥éª¤ï¼š**
1. å°†é…ç½®è½¬æ¢ä¸º YAML æ ¼å¼
2. æ”¾ç½®åˆ°ç›¸åº”çš„é…ç½®ç›®å½•
3. æ›´æ–°é…ç½®å¼•ç”¨

#### 5. å®šä¹‰ä¾èµ–å…³ç³»

**åˆ›å»º dependency.yamlï¼š**
```yaml
steps:
  - name: step1
    dependencies: []
  - name: step2
    dependencies: [step1]
```

---

## ç ´åæ€§å˜æ›´

### v2.0 ç ´åæ€§å˜æ›´

#### 1. ç›®å½•åç§°å˜æ›´

| æ—§åç§° | æ–°åç§° | å½±å“ |
|--------|--------|------|
| `scripts/` | `steps/` | éœ€è¦é‡å‘½åç›®å½• |
| `util/` | `helpers/` | éœ€è¦é‡å‘½åç›®å½• |
| `proc/` | `sub_steps/` | éœ€è¦é‡å‘½åç›®å½• |

#### 2. CLI å‚æ•°å˜æ›´

| æ—§å‚æ•° | æ–°å‚æ•° | å½±å“ |
|--------|--------|------|
| `--dir-list` | `--search-paths` | éœ€è¦æ›´æ–°è„šæœ¬ |
| `-I/--include` | `-d/--search-paths` | éœ€è¦æ›´æ–°è„šæœ¬ |

#### 3. API å˜æ›´

| æ—§ API | æ–° API | å½±å“ |
|--------|--------|------|
| `dir_list` å‚æ•° | `search_paths` å‚æ•° | éœ€è¦æ›´æ–°ä»£ç  |

#### 4. åŠŸèƒ½ç§»é™¤

| ç§»é™¤çš„åŠŸèƒ½ | æ›¿ä»£æ–¹æ¡ˆ | å½±å“ |
|-----------|---------|------|
| `#import util` | `#import source` | éœ€è¦æ›´æ–°è„šæœ¬ |

---

## è¿ç§»æ£€æŸ¥æ¸…å•

### å‡†å¤‡é˜¶æ®µ

- [ ] å¤‡ä»½ç°æœ‰é¡¹ç›®
- [ ] é˜…è¯»è¿ç§»æŒ‡å—
- [ ] äº†è§£ç ´åæ€§å˜æ›´
- [ ] å‡†å¤‡æµ‹è¯•ç¯å¢ƒ

### ç›®å½•ç»“æ„è¿ç§»

- [ ] é‡å‘½å `scripts/` ä¸º `steps/`
- [ ] é‡å‘½å `util/` ä¸º `helpers/`
- [ ] é‡å‘½å `proc/` ä¸º `sub_steps/`
- [ ] æ›´æ–°æ‰€æœ‰è·¯å¾„å¼•ç”¨

### é…ç½®è¿ç§»

- [ ] æ›´æ–°é…ç½®æ–‡ä»¶è·¯å¾„
- [ ] è½¬æ¢é…ç½®æ ¼å¼ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] éªŒè¯é…ç½®åŠ è½½

### è„šæœ¬è¿ç§»

- [ ] æ›¿æ¢ `#import util` ä¸º `#import source`
- [ ] æ›´æ–° CLI å‚æ•°
- [ ] æ›´æ–°è·¯å¾„å¼•ç”¨
- [ ] éªŒè¯è„šæœ¬æ‰§è¡Œ

### æµ‹è¯•éªŒè¯

- [ ] è¿è¡Œæ‰€æœ‰æµ‹è¯•
- [ ] éªŒè¯åŠŸèƒ½æ­£å¸¸
- [ ] æ£€æŸ¥æ—¥å¿—æ— é”™è¯¯
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

---

## è¿ç§»å·¥å…·

### è‡ªåŠ¨è¿ç§»è„šæœ¬

**ç›®å½•é‡å‘½åè„šæœ¬ï¼š**
```bash
#!/bin/bash
# migrate_directories.sh

# é‡å‘½åç›®å½•
find . -type d -name "scripts" -exec rename 's/scripts/steps/' {} \;
find . -type d -name "util" -exec rename 's/util/helpers/' {} \;
find . -type d -name "proc" -exec rename 's/proc/sub_steps/' {} \;
```

**è„šæœ¬å†…å®¹æ›¿æ¢è„šæœ¬ï¼š**
```bash
#!/bin/bash
# migrate_imports.sh

# æ›¿æ¢ #import util ä¸º #import source
find . -name "*.tcl" -exec sed -i 's/#import util/#import source/g' {} \;
```

### éªŒè¯è„šæœ¬

**éªŒè¯è¿ç§»ç»“æœï¼š**
```bash
#!/bin/bash
# verify_migration.sh

# æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ—§ç›®å½•å
if find . -type d -name "scripts" | grep -q .; then
    echo "ERROR: Found old 'scripts' directory"
    exit 1
fi

# æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ—§å¯¼å…¥æŒ‡ä»¤
if grep -r "#import util" .; then
    echo "ERROR: Found old '#import util' directive"
    exit 1
fi

echo "Migration verification passed"
```

---

## å›æ»šæ–¹æ¡ˆ

### å¦‚æœè¿ç§»å¤±è´¥

1. **æ¢å¤å¤‡ä»½**
   ```bash
   cp -r backup/* .
   ```

2. **æ£€æŸ¥é”™è¯¯æ—¥å¿—**
   ```bash
   cat logs/**/*.log | grep ERROR
   ```

3. **ä¿®å¤é—®é¢˜**
   - æ ¹æ®é”™è¯¯ä¿¡æ¯ä¿®å¤
   - é‡æ–°æµ‹è¯•

4. **é‡æ–°è¿ç§»**
   - ä½¿ç”¨ä¿®å¤åçš„è„šæœ¬
   - é€æ­¥è¿ç§»

---

## è·å–å¸®åŠ©

### æ–‡æ¡£èµ„æº

- [æ•™ç¨‹æ–‡æ¡£](../../tutorial/)
- [æ•…éšœæ’æŸ¥æŒ‡å—](../troubleshooting/troubleshooting_guide.md)
- [FAQ](../../tutorial/08_faq.md)

### ç¤¾åŒºæ”¯æŒ

- GitHub Issues
- GitHub Discussions

---

**æœ€åæ›´æ–°**: 2025-01-XX

