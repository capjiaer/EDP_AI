# æ€§èƒ½è°ƒä¼˜æŒ‡å—

æœ¬æ–‡æ¡£æä¾›æ€§èƒ½ä¼˜åŒ–å»ºè®®å’Œæœ€ä½³å®è·µã€‚

## ğŸ“‹ ç›®å½•

- [æ€§èƒ½æŒ‡æ ‡](#æ€§èƒ½æŒ‡æ ‡)
- [æ€§èƒ½ç“¶é¢ˆåˆ†æ](#æ€§èƒ½ç“¶é¢ˆåˆ†æ)
- [ä¼˜åŒ–ç­–ç•¥](#ä¼˜åŒ–ç­–ç•¥)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ€§èƒ½ç›‘æ§](#æ€§èƒ½ç›‘æ§)

---

## æ€§èƒ½æŒ‡æ ‡

### åŸºå‡†æŒ‡æ ‡

| æ“ä½œ | å°å‹é¡¹ç›® | ä¸­å‹é¡¹ç›® | å¤§å‹é¡¹ç›® |
|------|---------|---------|---------|
| è„šæœ¬å¤„ç†æ—¶é—´ | < 5 ç§’ | < 15 ç§’ | < 30 ç§’ |
| é…ç½®åŠ è½½æ—¶é—´ | < 1 ç§’ | < 3 ç§’ | < 5 ç§’ |
| æ–‡ä»¶æœç´¢æ—¶é—´ï¼ˆé¦–æ¬¡ï¼‰ | < 2 ç§’ | < 5 ç§’ | < 10 ç§’ |
| æ–‡ä»¶æœç´¢æ—¶é—´ï¼ˆç¼“å­˜ï¼‰ | < 0.1 ç§’ | < 0.5 ç§’ | < 1 ç§’ |
| å†…å­˜å ç”¨ | < 500 MB | < 1 GB | < 2 GB |

### æµ‹é‡æ€§èƒ½

```bash
# ä½¿ç”¨ time å‘½ä»¤æµ‹é‡æ‰§è¡Œæ—¶é—´
time edp -run pnr_innovus.place

# ä½¿ç”¨ Python çš„ time æ¨¡å—
python -m timeit "from edp_center.main import WorkflowManager; ..."
```

---

## æ€§èƒ½ç“¶é¢ˆåˆ†æ

### 1. æ–‡ä»¶æœç´¢æ€§èƒ½

**é—®é¢˜ï¼š**
- é€’å½’æœç´¢å¤§é‡æ–‡ä»¶æ—¶é€Ÿåº¦æ…¢
- é‡å¤æœç´¢ç›¸åŒæ–‡ä»¶

**åŸå› ï¼š**
- æ²¡æœ‰æ–‡ä»¶æœç´¢ç¼“å­˜
- æœç´¢è·¯å¾„è¿‡å¤šæˆ–è¿‡æ·±
- æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½é—®é¢˜

**è¯†åˆ«æ–¹æ³•ï¼š**
```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼æŸ¥çœ‹æœç´¢æ—¶é—´
edp -run step_name --debug 2>&1 | grep "search"
```

**ä¼˜åŒ–å»ºè®®ï¼š**
1. **å‡å°‘æœç´¢è·¯å¾„**
   ```bash
   # ä½¿ç”¨æ›´å…·ä½“çš„æœç´¢è·¯å¾„
   edp -run step_name --search-paths /specific/path
   ```

2. **å¯ç”¨æ–‡ä»¶æœç´¢ç¼“å­˜**ï¼ˆå¦‚æœå®ç°ï¼‰
   ```python
   # åœ¨é…ç½®ä¸­å¯ç”¨ç¼“å­˜
   edp:
     file_search:
       enable_cache: true
       cache_size: 1000
   ```

3. **ä¼˜åŒ–ç›®å½•ç»“æ„**
   - é¿å…è¿‡æ·±çš„ç›®å½•åµŒå¥—
   - ä½¿ç”¨æ‰å¹³åŒ–çš„ç›®å½•ç»“æ„

### 2. é…ç½®åˆå¹¶æ€§èƒ½

**é—®é¢˜ï¼š**
- å¤šä¸ªé…ç½®æ–‡ä»¶åˆå¹¶æ—¶é€Ÿåº¦æ…¢
- é…ç½®åŠ è½½æ—¶é—´è¿‡é•¿

**åŸå› ï¼š**
- é…ç½®æ–‡ä»¶è¿‡å¤š
- é…ç½®å±‚çº§è¿‡æ·±
- é…ç½®è§£ææœªç¼“å­˜

**è¯†åˆ«æ–¹æ³•ï¼š**
```bash
# æµ‹é‡é…ç½®åŠ è½½æ—¶é—´
time edp -info --load-config
```

**ä¼˜åŒ–å»ºè®®ï¼š**
1. **åˆå¹¶é…ç½®æ–‡ä»¶**
   ```yaml
   # å‡å°‘é…ç½®æ–‡ä»¶æ•°é‡
   # å°†å¤šä¸ªå°é…ç½®æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªå¤§æ–‡ä»¶
   ```

2. **å‡å°‘é…ç½®å±‚çº§**
   ```yaml
   # é¿å…è¿‡æ·±çš„åµŒå¥—
   # ä½¿ç”¨æ‰å¹³åŒ–çš„é…ç½®ç»“æ„
   ```

3. **ä½¿ç”¨é…ç½®ç¼“å­˜**ï¼ˆå¦‚æœå®ç°ï¼‰
   ```python
   # ç¼“å­˜å·²è§£æçš„é…ç½®
   ```

### 3. è„šæœ¬å¤„ç†æ€§èƒ½

**é—®é¢˜ï¼š**
- è„šæœ¬å¤„ç†æ—¶é—´è¿‡é•¿
- å†…å­˜å ç”¨è¿‡é«˜

**åŸå› ï¼š**
- #import æŒ‡ä»¤åµŒå¥—è¿‡æ·±
- Hooks æ–‡ä»¶è¿‡å¤§
- Sub_steps è¿‡å¤š

**è¯†åˆ«æ–¹æ³•ï¼š**
```bash
# æŸ¥çœ‹ç”Ÿæˆçš„è„šæœ¬å¤§å°
wc -l runs/pnr_innovus.place/full.tcl

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
ps aux | grep edp
```

**ä¼˜åŒ–å»ºè®®ï¼š**
1. **å‡å°‘ #import åµŒå¥—**
   ```tcl
   # é¿å…æ·±å±‚åµŒå¥—
   #import source file1.tcl  # ç›´æ¥å¯¼å…¥ï¼Œé¿å…åµŒå¥—
   ```

2. **ä¼˜åŒ– Hooks æ–‡ä»¶**
   ```tcl
   # ä¿æŒ Hooks æ–‡ä»¶ç®€æ´
   # é¿å…åœ¨ Hooks ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
   ```

3. **å‡å°‘ Sub_steps**
   - åˆå¹¶ç›¸å…³çš„ Sub_steps
   - ç§»é™¤ä¸å¿…è¦çš„ Sub_steps

**æ³¨æ„**ï¼šè„šæœ¬ç”Ÿæˆé‡‡ç”¨å…¨é‡ç”Ÿæˆæ–¹å¼ï¼Œä¸æ¨èå®ç°å¢é‡æ›´æ–°ï¼Œå› ä¸ºï¼š
- Sub_steps æ–‡ä»¶é€šå¸¸è¾ƒå°ï¼Œå…¨é‡ç”Ÿæˆæ€§èƒ½å¯æ¥å—
- å¢é‡æ›´æ–°ä¼šå¢åŠ ä»£ç å¤æ‚åº¦ï¼Œç»´æŠ¤æˆæœ¬é«˜
- ä¸ç¬¦åˆ KISS åŸåˆ™

### 4. å·¥ä½œæµæ‰§è¡Œæ€§èƒ½

**é—®é¢˜ï¼š**
- æ­¥éª¤æ‰§è¡Œæ—¶é—´è¿‡é•¿
- å¹¶å‘æ‰§è¡Œæ•ˆç‡ä½

**åŸå› ï¼š**
- æ­¥éª¤ä¾èµ–å…³ç³»å¤æ‚
- èµ„æºç«äº‰
- å‘½ä»¤æ‰§è¡Œæ•ˆç‡ä½

**è¯†åˆ«æ–¹æ³•ï¼š**
```bash
# æŸ¥çœ‹æ­¥éª¤æ‰§è¡Œæ—¶é—´
edp -info --step-timing

# æŸ¥çœ‹ä¾èµ–å…³ç³»
edp -info --show-dependencies
```

**ä¼˜åŒ–å»ºè®®ï¼š**
1. **ä¼˜åŒ–ä¾èµ–å…³ç³»**
   ```yaml
   # å‡å°‘ä¸å¿…è¦çš„ä¾èµ–
   # å…è®¸æ›´å¤šæ­¥éª¤å¹¶å‘æ‰§è¡Œ
   ```

2. **ä¼˜åŒ–å‘½ä»¤æ‰§è¡Œ**
   ```bash
   # ä½¿ç”¨æ›´é«˜æ•ˆçš„å‘½ä»¤
   # é¿å…é‡å¤æ‰§è¡Œç›¸åŒå‘½ä»¤
   ```

---

## ä¼˜åŒ–ç­–ç•¥

### çŸ­æœŸä¼˜åŒ–ï¼ˆç«‹å³å®æ–½ï¼‰

1. **å‡å°‘æœç´¢è·¯å¾„**
   - ä½¿ç”¨æ›´å…·ä½“çš„æœç´¢è·¯å¾„
   - ç§»é™¤ä¸å¿…è¦çš„æœç´¢è·¯å¾„

2. **åˆå¹¶é…ç½®æ–‡ä»¶**
   - å‡å°‘é…ç½®æ–‡ä»¶æ•°é‡
   - ç®€åŒ–é…ç½®ç»“æ„

3. **ä¼˜åŒ–è„šæœ¬ç»“æ„**
   - å‡å°‘ #import åµŒå¥—
   - ä¼˜åŒ– Hooks æ–‡ä»¶å¤§å°

### ä¸­æœŸä¼˜åŒ–ï¼ˆè¿‘æœŸå®æ–½ï¼‰

1. **å®ç°æ–‡ä»¶æœç´¢ç¼“å­˜**
   ```python
   # ç¼“å­˜æ–‡ä»¶æœç´¢ç»“æœ
   # åŸºäºç›®å½•ä¿®æ”¹æ—¶é—´æˆ³å¤±æ•ˆ
   ```

2. **å®ç°é…ç½®è§£æç¼“å­˜**
   ```python
   # ç¼“å­˜å·²è§£æçš„é…ç½®
   # åŸºäºæ–‡ä»¶ä¿®æ”¹æ—¶é—´æˆ³å¤±æ•ˆ
   ```

3. **ä¼˜åŒ–é…ç½®åˆå¹¶ç®—æ³•**
   ```python
   # å¢é‡åˆå¹¶
   # åªå¤„ç†å˜æ›´çš„é…ç½®
   ```

### é•¿æœŸä¼˜åŒ–ï¼ˆæœªæ¥è§„åˆ’ï¼‰

1. **å¹¶è¡Œå¤„ç†**
   - å¹¶è¡Œå¤„ç†å¤šä¸ªæ­¥éª¤
   - å¹¶è¡Œå¤„ç†å¤šä¸ªæ–‡ä»¶

2. **å¼‚æ­¥æ‰§è¡Œ**
   - å¼‚æ­¥æ‰§è¡Œé•¿æ—¶é—´æ“ä½œ
   - å¼‚æ­¥åŠ è½½é…ç½®

3. **æ•°æ®åº“å­˜å‚¨**
   - ä½¿ç”¨æ•°æ®åº“å­˜å‚¨å…ƒæ•°æ®
   - æé«˜æŸ¥è¯¢æ•ˆç‡

---

## æœ€ä½³å®è·µ

### 1. ç›®å½•ç»“æ„ä¼˜åŒ–

**æ¨èç»“æ„ï¼š**
```
project/
â”œâ”€â”€ cmds/
â”‚   â””â”€â”€ flow_name/
â”‚       â”œâ”€â”€ steps/          # ä¸»è„šæœ¬
â”‚       â”œâ”€â”€ sub_steps/      # Sub_steps
â”‚       â””â”€â”€ helpers/        # è¾…åŠ©æ–‡ä»¶
â””â”€â”€ config/
    â””â”€â”€ flow_name/
        â””â”€â”€ config.yaml     # é…ç½®æ–‡ä»¶
```

**é¿å…ï¼š**
- è¿‡æ·±çš„ç›®å½•åµŒå¥—ï¼ˆ> 5 å±‚ï¼‰
- åˆ†æ•£çš„æ–‡ä»¶ä½ç½®
- é‡å¤çš„ç›®å½•ç»“æ„

### 2. é…ç½®æ–‡ä»¶ä¼˜åŒ–

**æ¨èåšæ³•ï¼š**
```yaml
# ä½¿ç”¨æ‰å¹³åŒ–çš„é…ç½®ç»“æ„
project:
  name: dongting
  version: P85
  blocks:
    block1: user1 user2
```

**é¿å…ï¼š**
- è¿‡æ·±çš„åµŒå¥—ï¼ˆ> 3 å±‚ï¼‰
- é‡å¤çš„é…ç½®é¡¹
- ä¸å¿…è¦çš„é…ç½®å±‚çº§

### 3. è„šæœ¬ä¼˜åŒ–

**æ¨èåšæ³•ï¼š**
```tcl
# ç›´æ¥å¯¼å…¥ï¼Œé¿å…åµŒå¥—
#import source helper1.tcl
#import source helper2.tcl

# ä¿æŒ Hooks æ–‡ä»¶ç®€æ´
# hooks/step.pre
puts "Before step"
```

**é¿å…ï¼š**
- æ·±å±‚åµŒå¥—çš„ #import
- è¿‡å¤§çš„ Hooks æ–‡ä»¶
- ä¸å¿…è¦çš„ Sub_steps

### 4. æœç´¢è·¯å¾„ä¼˜åŒ–

**æ¨èåšæ³•ï¼š**
```bash
# ä½¿ç”¨å…·ä½“çš„æœç´¢è·¯å¾„
edp -run step_name \
  --search-paths /path/to/helpers \
  --search-paths /path/to/common
```

**é¿å…ï¼š**
- æœç´¢æ•´ä¸ªé¡¹ç›®ç›®å½•
- åŒ…å«å¤§é‡æ–‡ä»¶çš„ç›®å½•
- é‡å¤çš„æœç´¢è·¯å¾„

---

## æ€§èƒ½ç›‘æ§

### å¯ç”¨æ€§èƒ½æ—¥å¿—

```bash
# è®¾ç½®æ—¥å¿—çº§åˆ«ä¸º DEBUG
export EDP_LOG_LEVEL=DEBUG

# è¿è¡Œå‘½ä»¤
edp -run step_name
```

### åˆ†ææ€§èƒ½æ•°æ®

```bash
# æå–æ€§èƒ½æ•°æ®
grep "elapsed" logs/**/*.log

# åˆ†ææ€§èƒ½è¶‹åŠ¿
# ä½¿ç”¨è„šæœ¬åˆ†ææ—¥å¿—æ–‡ä»¶
```

### æ€§èƒ½æŠ¥å‘Š

å®šæœŸç”Ÿæˆæ€§èƒ½æŠ¥å‘Šï¼š

```bash
# ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
edp -info --performance-report

# è¾“å‡ºæ ¼å¼ï¼š
# Operation          | Time (s) | Memory (MB)
# ------------------|----------|------------
# Config Loading    | 0.5      | 50
# Script Processing | 3.2      | 200
# Step Execution    | 15.8     | 300
```

---

## æ€§èƒ½æµ‹è¯•

### åŸºå‡†æµ‹è¯•

åˆ›å»ºåŸºå‡†æµ‹è¯•æ¥æµ‹é‡æ€§èƒ½ï¼š

```python
import time
from edp_center.main import WorkflowManager

def benchmark_config_loading():
    """æµ‹è¯•é…ç½®åŠ è½½æ€§èƒ½"""
    manager = WorkflowManager('edp_center')
    start = time.time()
    config = manager.load_config(...)
    elapsed = time.time() - start
    print(f"Config loading: {elapsed:.2f}s")
    return elapsed

def benchmark_script_processing():
    """æµ‹è¯•è„šæœ¬å¤„ç†æ€§èƒ½"""
    # ...
```

### æ€§èƒ½å›å½’æµ‹è¯•

åœ¨ CI/CD ä¸­æ·»åŠ æ€§èƒ½å›å½’æµ‹è¯•ï¼š

```yaml
# .github/workflows/performance.yml
name: Performance Tests
on: [push, pull_request]
jobs:
  performance:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run performance tests
        run: |
          pytest tests/performance/ --benchmark-only
```

---

## æ€§èƒ½è°ƒä¼˜æ£€æŸ¥æ¸…å•

### é…ç½®ä¼˜åŒ–

- [ ] å‡å°‘é…ç½®æ–‡ä»¶æ•°é‡
- [ ] ç®€åŒ–é…ç½®ç»“æ„
- [ ] ç§»é™¤ä¸å¿…è¦çš„é…ç½®é¡¹
- [ ] ä½¿ç”¨é…ç½®ç¼“å­˜ï¼ˆå¦‚æœå¯ç”¨ï¼‰

### æ–‡ä»¶æœç´¢ä¼˜åŒ–

- [ ] ä½¿ç”¨å…·ä½“çš„æœç´¢è·¯å¾„
- [ ] å‡å°‘æœç´¢è·¯å¾„æ•°é‡
- [ ] å¯ç”¨æ–‡ä»¶æœç´¢ç¼“å­˜ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- [ ] ä¼˜åŒ–ç›®å½•ç»“æ„

### è„šæœ¬ä¼˜åŒ–

- [ ] å‡å°‘ #import åµŒå¥—
- [ ] ä¼˜åŒ– Hooks æ–‡ä»¶å¤§å°
- [ ] å‡å°‘ Sub_steps æ•°é‡
- [ ] ä¼˜åŒ–è„šæœ¬å†…å®¹

### å·¥ä½œæµä¼˜åŒ–

- [ ] ä¼˜åŒ–ä¾èµ–å…³ç³»
- [ ] å¯ç”¨å¹¶å‘æ‰§è¡Œ
- [ ] ä¼˜åŒ–å‘½ä»¤æ‰§è¡Œ
- [ ] å‡å°‘èµ„æºç«äº‰

---

**æœ€åæ›´æ–°**: 2025-01-XX

