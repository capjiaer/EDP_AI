# é”™è¯¯å¤„ç†è¿ç§»è®¡åˆ’

## ç°çŠ¶åˆ†æ

### ç°æœ‰é”™è¯¯å¤„ç†æ¨¡å¼

1. **ç®€å•æ¨¡å¼**ï¼ˆé€‚åˆè¿ç§»ï¼‰ï¼š
   ```python
   def handle_command(args):
       try:
           do_something()
           return 0
       except Exception as e:
           print(f"[ERROR] å¤±è´¥: {e}", file=sys.stderr)
           traceback.print_exc()
           return 1
   ```

2. **å¤æ‚æ¨¡å¼**ï¼ˆä¿ç•™ç°æœ‰é€»è¾‘ï¼‰ï¼š
   ```python
   def handle_command(args):
       try:
           # å¤šä¸ªæ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤æœ‰ç‰¹å®šçš„é”™è¯¯å¤„ç†
           try:
               step1()
           except ValueError as e:
               # ç‰¹å®šé”™è¯¯å¤„ç†
               handle_value_error(e)
           
           try:
               step2()
           except FileNotFoundError as e:
               # ç‰¹å®šé”™è¯¯å¤„ç†
               handle_file_error(e)
       except Exception as e:
           # é¡¶å±‚é”™è¯¯å¤„ç†
           return 1
   ```

## è¿ç§»ç­–ç•¥

### âœ… å»ºè®®è¿ç§»ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰

**æ ‡å‡† CLI å‘½ä»¤å¤„ç†å‡½æ•°**ï¼š
- `handlers.py` ä¸­çš„ç®€å•å‘½ä»¤å¤„ç†å‡½æ•°
- è¿™äº›å‡½æ•°é€šå¸¸åªæœ‰ä¸€å±‚ try-exceptï¼Œé€‚åˆç”¨è£…é¥°å™¨

**ç¤ºä¾‹**ï¼š
```python
# æ—§ä»£ç 
def handle_load_config(manager, args):
    try:
        config = manager.load_config(...)
        return 0
    except Exception as e:
        print(f"[ERROR] åŠ è½½é…ç½®å¤±è´¥: {e}", file=sys.stderr)
        return 1

# æ–°ä»£ç 
@handle_cli_error(error_message="åŠ è½½é…ç½®å¤±è´¥")
def handle_load_config(manager, args):
    config = manager.load_config(...)
    return 0
```

### âš ï¸ éƒ¨åˆ†è¿ç§»ï¼ˆä¼˜å…ˆçº§ä¸­ï¼‰

**å¤æ‚å‡½æ•°ä¸­çš„é¡¶å±‚é”™è¯¯å¤„ç†**ï¼š
- ä¿ç•™å†…éƒ¨çš„ç‰¹å®šé”™è¯¯å¤„ç†
- åªè¿ç§»æœ€å¤–å±‚çš„é€šç”¨é”™è¯¯å¤„ç†

**ç¤ºä¾‹**ï¼š
```python
# æ—§ä»£ç 
def execute_single_step(manager, args, flow_step):
    try:
        # å¤æ‚çš„å†…éƒ¨é€»è¾‘ï¼Œæœ‰ç‰¹å®šçš„é”™è¯¯å¤„ç†
        try:
            step1()
        except ValueError as e:
            handle_specific_error(e)
        
        try:
            step2()
        except FileNotFoundError as e:
            handle_file_error(e)
    except Exception as e:
        print(f"[ERROR] æ‰§è¡Œå¤±è´¥: {e}", file=sys.stderr)
        traceback.print_exc()
        return 1

# æ–°ä»£ç ï¼ˆåªè¿ç§»é¡¶å±‚ï¼‰
@handle_cli_error(error_message="æ‰§è¡Œå¤±è´¥")
def execute_single_step(manager, args, flow_step):
    # ä¿ç•™å†…éƒ¨çš„ç‰¹å®šé”™è¯¯å¤„ç†
    try:
        step1()
    except ValueError as e:
        handle_specific_error(e)
    
    try:
        step2()
    except FileNotFoundError as e:
        handle_file_error(e)
```

### âŒ ä¸å»ºè®®è¿ç§»ï¼ˆä¼˜å…ˆçº§ä½ï¼‰

**éœ€è¦ç‰¹å®šé”™è¯¯å¤„ç†é€»è¾‘çš„å‡½æ•°**ï¼š
- æœ‰å¤šä¸ª try-except å—ï¼Œæ¯ä¸ªå¤„ç†ä¸åŒçš„é”™è¯¯ç±»å‹
- éœ€è¦æ ¹æ®é”™è¯¯ç±»å‹æ‰§è¡Œä¸åŒçš„é€»è¾‘
- éœ€è¦è®¿é—®å¼‚å¸¸å¯¹è±¡çš„ç‰¹å®šå±æ€§

**ç¤ºä¾‹**ï¼š
```python
# ä¿ç•™ç°æœ‰ä»£ç ï¼Œä¸éœ€è¦è¿ç§»
def complex_handler(args):
    try:
        result = risky_operation()
    except ValueError as e:
        # éœ€è¦ç‰¹å®šçš„é”™è¯¯å¤„ç†é€»è¾‘
        if "invalid format" in str(e):
            fix_format()
        else:
            raise
    except FileNotFoundError as e:
        # éœ€è¦ç‰¹å®šçš„é”™è¯¯å¤„ç†é€»è¾‘
        create_default_file()
    except Exception as e:
        # é€šç”¨é”™è¯¯å¤„ç†
        log_and_notify(e)
        return 1
```

## è¿ç§»ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³è¿ç§»ï¼‰

1. **`handlers.py`** ä¸­çš„ç®€å•å‘½ä»¤å¤„ç†å‡½æ•°
   - `handle_load_config()`
   - `handle_process_script()`
   - `handle_load_workflow()`
   - `handle_run_workflow()`

**åŸå› **ï¼šè¿™äº›å‡½æ•°é”™è¯¯å¤„ç†ç®€å•ï¼Œè¿ç§»åä»£ç æ›´æ¸…æ™°ã€‚

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆé€æ­¥è¿ç§»ï¼‰

2. **å…¶ä»– CLI å‘½ä»¤å¤„ç†å‡½æ•°**
   - `run_single_step.py` ä¸­çš„é¡¶å±‚é”™è¯¯å¤„ç†
   - `run_range.py` ä¸­çš„é¡¶å±‚é”™è¯¯å¤„ç†
   - `graph_handler.py` ä¸­çš„ç®€å•é”™è¯¯å¤„ç†

**åŸå› **ï¼šè¿™äº›å‡½æ•°è¾ƒå¤æ‚ï¼Œéœ€è¦ä»”ç»†è¯„ä¼°ã€‚

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆæŒ‰éœ€è¿ç§»ï¼‰

3. **å¤æ‚å‡½æ•°ä¸­çš„ç‰¹å®šé”™è¯¯å¤„ç†**
   - ä¿ç•™ç°æœ‰é€»è¾‘ï¼Œåªåœ¨å¿…è¦æ—¶ä¼˜åŒ–

**åŸå› **ï¼šè¿™äº›å‡½æ•°æœ‰ç‰¹å®šçš„é”™è¯¯å¤„ç†éœ€æ±‚ï¼Œè¿ç§»å¯èƒ½å½±å“åŠŸèƒ½ã€‚

## è¿ç§»æ­¥éª¤

### é˜¶æ®µ 1ï¼šç®€å•å‡½æ•°è¿ç§»ï¼ˆ1-2å¤©ï¼‰

1. è¿ç§» `handlers.py` ä¸­çš„ 4 ä¸ªç®€å•å‡½æ•°
2. æµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸
3. éªŒè¯é”™è¯¯è¾“å‡ºæ ¼å¼

### é˜¶æ®µ 2ï¼šé€æ­¥è¿ç§»ï¼ˆæŒ‰éœ€ï¼‰

1. æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µï¼Œé€æ­¥è¿ç§»å…¶ä»–å‡½æ•°
2. æ¯æ¬¡è¿ç§»åå……åˆ†æµ‹è¯•
3. ä¿ç•™ç°æœ‰ä»£ç ä½œä¸ºå¤‡ä»½ï¼ˆGit ç‰ˆæœ¬æ§åˆ¶ï¼‰

### é˜¶æ®µ 3ï¼šä¼˜åŒ–å’Œæ–‡æ¡£ï¼ˆæŒç»­ï¼‰

1. æ”¶é›†ä½¿ç”¨åé¦ˆ
2. ä¼˜åŒ–è£…é¥°å™¨åŠŸèƒ½
3. æ›´æ–°æ–‡æ¡£å’Œç¤ºä¾‹

## è¿ç§»æ£€æŸ¥æ¸…å•

è¿ç§»å‰ï¼š
- [ ] ç¡®è®¤å‡½æ•°åªæœ‰ç®€å•çš„ try-except å—
- [ ] ç¡®è®¤ä¸éœ€è¦ç‰¹å®šçš„é”™è¯¯å¤„ç†é€»è¾‘
- [ ] ç¡®è®¤é”™è¯¯æ¶ˆæ¯å¯ä»¥ç»Ÿä¸€

è¿ç§»åï¼š
- [ ] æµ‹è¯•æ­£å¸¸æµç¨‹
- [ ] æµ‹è¯•é”™è¯¯æµç¨‹
- [ ] éªŒè¯é”™è¯¯è¾“å‡ºæ ¼å¼
- [ ] éªŒè¯æ—¥å¿—è®°å½•ï¼ˆå¦‚æœé…ç½®äº†æ—¥å¿—ï¼‰

## å»ºè®®

**ä¸éœ€è¦å…¨éƒ¨è¿ç§»**ï¼ŒåŸå› ï¼š
1. æœ‰äº›å‡½æ•°æœ‰ç‰¹å®šçš„é”™è¯¯å¤„ç†éœ€æ±‚
2. è¿ç§»æœ‰é£é™©ï¼Œéœ€è¦å……åˆ†æµ‹è¯•
3. æ¸è¿›å¼è¿ç§»æ›´å®‰å…¨

**ä¼˜å…ˆè¿ç§»**ï¼š
- ç®€å•ã€é‡å¤çš„é”™è¯¯å¤„ç†æ¨¡å¼
- æ–°ä»£ç ç›´æ¥ä½¿ç”¨æ–°è£…é¥°å™¨
- æ—§ä»£ç æŒ‰éœ€é€æ­¥è¿ç§»

