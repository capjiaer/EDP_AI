<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDP å·¥ä½œæµæ‰§è¡Œç³»ç»Ÿ</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://unpkg.com/dagre-d3@0.6.4/dist/dagre-d3.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div>
                <h1>ğŸš€ EDP å·¥ä½œæµæ‰§è¡Œç³»ç»Ÿ</h1>
                <div class="subtitle">å¯è§†åŒ–ä¾èµ–å…³ç³» Â· ä¸€é”®æ‰§è¡Œæ­¥éª¤</div>
            </div>
            <div class="status-badge" id="status-badge">å°±ç»ª</div>
        </div>
        
        <div class="toolbar">
            <button class="btn btn-primary" onclick="loadWorkflow()">
                <span>ğŸ”„</span> åˆ·æ–°å·¥ä½œæµ
            </button>
            <button class="btn btn-secondary" onclick="clearStatus()">
                <span>ğŸ—‘ï¸</span> æ¸…é™¤çŠ¶æ€
            </button>
            <div style="flex: 1;"></div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">æ€»æ­¥éª¤</div>
                    <div class="stat-value" id="stat-total">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å·²å®Œæˆ</div>
                    <div class="stat-value" id="stat-success">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">è¿è¡Œä¸­</div>
                    <div class="stat-value" id="stat-running">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å¤±è´¥</div>
                    <div class="stat-value" id="stat-failed">-</div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="graph-panel">
                <div id="graph-container"></div>
            </div>
            
            <div class="log-panel">
                <h3>ğŸ“‹ æ‰§è¡Œæ—¥å¿—</h3>
                <div id="log-container"></div>
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        // å…¨å±€æ‹¦æˆªæ‰€æœ‰å¯èƒ½çš„æ–‡ä»¶æ‰“å¼€è¡Œä¸º
        (function() {
            // æ‹¦æˆªæ‰€æœ‰é“¾æ¥ç‚¹å‡»
            document.addEventListener('click', function(event) {
                const target = event.target;
                // å¦‚æœç‚¹å‡»çš„æ˜¯ SVG å†…çš„å…ƒç´ ï¼Œä¸”ä¸æ˜¯æˆ‘ä»¬çš„èŠ‚ç‚¹ï¼Œé˜»æ­¢é»˜è®¤è¡Œä¸º
                if (target.closest && target.closest('#graph-container')) {
                    const nodeElement = target.closest('g.node');
                    if (!nodeElement || nodeElement.getAttribute('data-has-handler') !== 'true') {
                        event.preventDefault();
                        event.stopPropagation();
                        event.stopImmediatePropagation();
                        return false;
                    }
                }
            }, true);  // ä½¿ç”¨ capture é˜¶æ®µ
            
            // æ‹¦æˆªæ‰€æœ‰ mousedown äº‹ä»¶
            document.addEventListener('mousedown', function(event) {
                const target = event.target;
                if (target.closest && target.closest('#graph-container')) {
                    const nodeElement = target.closest('g.node');
                    if (!nodeElement || nodeElement.getAttribute('data-has-handler') !== 'true') {
                        event.preventDefault();
                        event.stopPropagation();
                        event.stopImmediatePropagation();
                        return false;
                    }
                }
            }, true);
            
            // æ‹¦æˆªæ‰€æœ‰å¯èƒ½çš„æ–‡ä»¶æ‰“å¼€è¡Œä¸º
            window.addEventListener('beforeunload', function(event) {
                // ä¸é˜»æ­¢é¡µé¢å¸è½½ï¼Œåªæ˜¯ç¡®ä¿æ²¡æœ‰æ–‡ä»¶æ‰“å¼€
            });
        })();
    </script>
</body>
</html>

